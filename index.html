<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>B√°o C√°o Digital Coverage & D·ª± B√°o Q1 2026 - PNJ ƒêNB</title>
    
    <!-- CSS Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Leaflet Map CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcfbf9;
            color: #1f2937;
            -webkit-font-smoothing: antialiased;
        }
        h1, h2, h3, .serif-font {
            font-family: 'Playfair Display', serif;
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        /* Map Styles */
        #map {
            height: 100%;
            width: 100%;
            z-index: 1;
        }
        .store-item.active {
            background-color: #fffbeb; /* amber-50 */
            border-left: 4px solid #d97706;
        }

        /* Mobile Optimization for Charts */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 280px;
            touch-action: pan-y;
        }
        @media (min-width: 640px) { .chart-container { height: 350px; } }
        @media (min-width: 1024px) { .chart-container { height: 400px; } }

        /* Custom Scrollbar for store list */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d6d3d1;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a8a29e;
        }

        /* Chatbot Styles */
        #chatbot-window {
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            transform-origin: bottom right;
        }
        .chat-bubble-user {
            background-color: #d97706;
            color: white;
            border-radius: 12px 12px 0 12px;
        }
        .chat-bubble-ai {
            background-color: #f3f4f6;
            color: #1f2937;
            border-radius: 12px 12px 12px 0;
        }
        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #d97706;
            border-radius: 50%;
            animation: typing 1s infinite ease-in-out;
            margin: 0 2px;
        }
        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .tab-btn-active {
            border-bottom: 2px solid #b45309;
            color: #78350f;
            font-weight: 600;
        }
        .tab-btn-inactive {
            color: #6b7280;
            border-bottom: 2px solid transparent;
        }
    </style>
</head>
<body class="antialiased h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-stone-200 z-30 flex-shrink-0 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-amber-500 rounded-full flex items-center justify-center text-white font-bold serif-font flex-shrink-0">P</div>
                <div>
                    <h1 class="text-lg sm:text-xl font-bold text-stone-900 leading-none truncate max-w-[200px] sm:max-w-none">B√°o C√°o Digital Coverage</h1>
                    <p class="text-xs text-stone-500 mt-0.5">Khu V·ª±c ƒê√¥ng Nam B·ªô | Th√°ng 01/2026</p>
                </div>
            </div>
            
            <!-- Dynamic Navigation Toggle Button -->
            <div class="flex">
                <button onclick="toggleMainView()" id="nav-toggle" class="flex items-center gap-2 px-4 py-2 font-medium text-sm rounded-lg transition-all border-2 border-amber-500 text-amber-700 bg-amber-50 hover:bg-amber-100 hover:shadow-md">
                    <i id="nav-toggle-icon" class="fa-solid fa-map-location-dot"></i>
                    <span id="nav-toggle-text" class="hidden sm:inline">Xem B·∫£n ƒê·ªì</span>
                    <span id="nav-toggle-text-mobile" class="sm:hidden">B·∫£n ƒê·ªì</span>
                </button>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT AREA -->
    <div class="flex-grow relative overflow-hidden bg-stone-50">
        
        <!-- VIEW 1: REPORT (Original Full Version) -->
        <main id="view-report" class="absolute inset-0 overflow-y-auto p-4 sm:p-8 space-y-8 sm:space-y-12 transition-opacity duration-300">
            <div class="max-w-7xl mx-auto space-y-8">
                <!-- Section 1: Executive Overview -->
                <section>
                    <div class="mb-4 sm:mb-6">
                        <h2 class="text-xl sm:text-2xl font-bold text-stone-800 mb-2">1. T·ªïng Quan Hi·ªáu Qu·∫£</h2>
                        <p class="text-sm sm:text-base text-stone-600 max-w-3xl">
                            Ph·∫ßn n√†y cung c·∫•p c√°i nh√¨n to√†n c·∫£nh v·ªÅ m·ª©c ƒë·ªô hi·ªán di·ªán c·ªßa PNJ tr√™n kh√¥ng gian s·ªë. 
                            M·∫∑c d√π ƒë·ªô ph·ªß (Reach) ch∆∞a ƒë·∫°t m·ª©c t·ªëi ƒëa, nh∆∞ng ch·∫•t l∆∞·ª£ng t∆∞∆°ng t√°c (Inbox, Ch·ªâ ƒë∆∞·ªùng) r·∫•t kh·∫£ quan.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6">
                        <!-- KPI 1 -->
                        <div class="bg-white p-5 sm:p-6 rounded-lg border border-stone-200 card-shadow transition hover:-translate-y-1 duration-300">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-xs sm:text-sm font-medium text-stone-500 uppercase tracking-wide">ƒê·ªô Ph·ªß (Reach)</p>
                                    <h3 class="text-3xl sm:text-4xl font-bold text-stone-900 mt-2">1.5M</h3>
                                </div>
                                <span class="text-2xl">üì°</span>
                            </div>
                            <div class="mt-4">
                                <div class="flex justify-between text-xs text-stone-500 mb-1">
                                    <span>Hi·ªán t·∫°i: 42%</span>
                                    <span>M·ª•c ti√™u: 100%</span>
                                </div>
                                <div class="w-full bg-stone-100 rounded-full h-2">
                                    <div class="bg-amber-500 h-2 rounded-full" style="width: 42%"></div>
                                </div>
                                <p class="text-xs text-stone-500 mt-2 italic">Ti·ªÅm nƒÉng m·ªü r·ªông c√≤n r·∫•t l·ªõn.</p>
                            </div>
                        </div>

                        <!-- KPI 2 -->
                        <div class="bg-white p-5 sm:p-6 rounded-lg border border-stone-200 card-shadow transition hover:-translate-y-1 duration-300">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-xs sm:text-sm font-medium text-stone-500 uppercase tracking-wide">Inbox T∆∞ V·∫•n</p>
                                    <h3 class="text-3xl sm:text-4xl font-bold text-blue-900 mt-2">16,000+</h3>
                                </div>
                                <span class="text-2xl">üí¨</span>
                            </div>
                            <p class="mt-4 text-xs sm:text-sm text-stone-600">
                                Kh√°ch h√†ng ch·ªß ƒë·ªông nh·∫Øn tin h·ªèi mua. ƒê√¢y l√† nh√≥m kh√°ch c√≥ nhu c·∫ßu cao ("High Intent").
                            </p>
                        </div>

                        <!-- KPI 3 -->
                        <div class="bg-white p-5 sm:p-6 rounded-lg border border-stone-200 card-shadow transition hover:-translate-y-1 duration-300">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-xs sm:text-sm font-medium text-stone-500 uppercase tracking-wide">T√¨m ƒê∆∞·ªùng (Maps)</p>
                                    <h3 class="text-3xl sm:text-4xl font-bold text-emerald-800 mt-2">12,000+</h3>
                                </div>
                                <span class="text-2xl">üìç</span>
                            </div>
                            <p class="mt-4 text-xs sm:text-sm text-stone-600">
                                L∆∞·ª£t kh√°ch b·∫•m ch·ªâ ƒë∆∞·ªùng ƒë·ªÉ ƒë·∫øn c·ª≠a h√†ng. T√≠n hi·ªáu chuy·ªÉn ƒë·ªïi Online-to-Offline m·∫°nh m·∫Ω.
                            </p>
                        </div>
                    </div>
                </section>

                <!-- Section 2: Regional Analysis -->
                <section>
                    <div class="mb-4 sm:mb-6">
                        <h2 class="text-xl sm:text-2xl font-bold text-stone-800 mb-2">2. Ph√¢n T√≠ch Khu V·ª±c & C·ª≠a H√†ng</h2>
                        <p class="text-sm sm:text-base text-stone-600 max-w-3xl">
                            Bi·ªÉu ƒë·ªì d∆∞·ªõi ƒë√¢y so s√°nh hi·ªáu su·∫•t gi·ªØa c√°c t·ªânh d·ª±a tr√™n <strong>T·ª∑ l·ªá th√¢m nh·∫≠p</strong> v√† <strong>Quy m√¥ t∆∞∆°ng t√°c</strong>.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8">
                        <!-- Chart Col -->
                        <div class="lg:col-span-2 bg-white p-4 sm:p-6 rounded-lg border border-stone-200 card-shadow">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-base sm:text-lg font-semibold text-stone-800">M·ª©c ƒê·ªô S√¥i N·ªïi Theo T·ªânh</h3>
                                <div class="group relative">
                                    <span class="cursor-help text-stone-400">‚ìò</span>
                                    <div class="absolute right-0 w-64 p-3 bg-stone-800 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none group-hover:pointer-events-auto">
                                        ƒêi·ªÉm s·ªë t√≠nh d·ª±a tr√™n: T·ª∑ l·ªá Reach/D√¢n s·ªë ti·ªÅm nƒÉng (50%) + L∆∞·ª£ng t∆∞∆°ng t√°c tuy·ªát ƒë·ªëi (30%) + T·ª∑ l·ªá chuy·ªÉn ƒë·ªïi (20%).
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="regionalChart"></canvas>
                            </div>
                        </div>

                        <!-- Detailed Text Col -->
                        <div class="space-y-4">
                            <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4">
                                <h4 class="font-bold text-emerald-800 flex items-center gap-2">üèÜ ƒê·ªìng Nai & B√¨nh D∆∞∆°ng</h4>
                                <p class="text-sm text-emerald-700 mt-1">
                                    Hi·ªáu su·∫•t R·∫•t T·ªët & Kh√°. Kh√°ch h√†ng quan t√¢m s√¥i n·ªïi. C·∫ßn t·∫≠p trung gi·ªõi thi·ªáu m·∫´u m·ªõi.
                                </p>
                            </div>
                            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
                                <h4 class="font-bold text-yellow-800 flex items-center gap-2">‚öñÔ∏è T√¢y Ninh</h4>
                                <p class="text-sm text-yellow-700 mt-1">
                                    M·ª©c trung b√¨nh. C·∫ßn n·ªó l·ª±c th√™m ƒë·ªÉ thu h√∫t s·ª± ch√∫ √Ω.
                                </p>
                            </div>
                            <div class="bg-red-50 border-l-4 border-red-500 p-4">
                                <h4 class="font-bold text-red-800 flex items-center gap-2">‚ö†Ô∏è B√¨nh Ph∆∞·ªõc & BR-VT</h4>
                                <p class="text-sm text-red-700 mt-1">
                                    Hi·ªáu su·∫•t Th·∫•p. C·∫ßn tƒÉng ng√¢n s√°ch qu·∫£ng c√°o ƒë·ªÉ "nh·∫Øc nh·ªõ".
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Store Level Performance -->
                    <div class="mt-6 sm:mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Good Stores -->
                        <div class="bg-white p-5 sm:p-6 rounded-lg border border-stone-200 card-shadow">
                            <h3 class="text-base sm:text-lg font-bold text-stone-800 mb-4 flex items-center gap-2">
                                <span class="text-amber-500">‚òÖ</span> ƒêi·ªÉm S√°ng Ho·∫°t ƒê·ªông
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <p class="text-xs font-semibold text-stone-500 uppercase">Top Inbox (T∆∞ v·∫•n)</p>
                                    <ul class="mt-2 text-sm text-stone-700 space-y-2">
                                        <li class="flex justify-between border-b border-stone-100 pb-1">
                                            <span class="truncate pr-2">PNJ H√πng V∆∞∆°ng - Long Kh√°nh</span>
                                            <span class="font-bold bg-blue-100 text-blue-800 px-2 rounded whitespace-nowrap">Top 1</span>
                                        </li>
                                        <li class="flex justify-between border-b border-stone-100 pb-1">
                                            <span class="truncate pr-2">PNJ ƒêL B√¨nh D∆∞∆°ng - TDM</span>
                                            <span class="font-bold bg-blue-100 text-blue-800 px-2 rounded whitespace-nowrap">Top 2</span>
                                        </li>
                                    </ul>
                                </div>
                                <div class="mt-4">
                                    <p class="text-xs font-semibold text-stone-500 uppercase">Top Directions (Gh√© thƒÉm)</p>
                                    <ul class="mt-2 text-sm text-stone-700 space-y-2">
                                        <li class="flex justify-between border-b border-stone-100 pb-1">
                                            <span class="truncate pr-2">PNJ AEON B√¨nh D∆∞∆°ng</span>
                                            <span class="font-bold bg-emerald-100 text-emerald-800 px-2 rounded whitespace-nowrap">√Åp ƒë·∫£o</span>
                                        </li>
                                        <li class="flex justify-between border-b border-stone-100 pb-1">
                                            <span class="truncate pr-2">PNJ H√πng V∆∞∆°ng - TDM</span>
                                            <span class="font-bold bg-emerald-100 text-emerald-800 px-2 rounded whitespace-nowrap">Cao</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Bad Stores (Alert) -->
                        <div class="bg-white p-5 sm:p-6 rounded-lg border-2 border-red-100 card-shadow relative overflow-hidden">
                            <div class="absolute top-0 right-0 bg-red-500 text-white text-[10px] sm:text-xs font-bold px-2 py-1 rounded-bl">C·∫¶N X·ª¨ L√ù</div>
                            <h3 class="text-base sm:text-lg font-bold text-red-700 mb-2 flex items-center gap-2">
                                <span>üö´</span> V·∫•n ƒê·ªÅ: Zero Inbox
                            </h3>
                            <p class="text-xs sm:text-sm text-stone-600 mb-4">
                                C√°c c·ª≠a h√†ng d∆∞·ªõi ƒë√¢y c√≥ l∆∞·ª£t t√¨m ki·∫øm cao nh∆∞ng <strong>KH√îNG</strong> c√≥ tin nh·∫Øn n√†o.
                            </p>
                            <ul class="space-y-3">
                                <li class="flex items-center gap-3 p-2 bg-red-50 rounded border border-red-100">
                                    <span class="text-red-500">üè¢</span>
                                    <span class="text-stone-800 font-medium text-xs sm:text-sm">PNJ Qu·ªëc L·ªô 1K - Dƒ© An</span>
                                </li>
                                <li class="flex items-center gap-3 p-2 bg-red-50 rounded border border-red-100">
                                    <span class="text-red-500">üè¢</span>
                                    <span class="text-stone-800 font-medium text-xs sm:text-sm">PNJ 22/12 - Thu·∫≠n An</span>
                                </li>
                                <li class="flex items-center gap-3 p-2 bg-red-50 rounded border border-red-100">
                                    <span class="text-red-500">üè¢</span>
                                    <span class="text-stone-800 font-medium text-xs sm:text-sm">PNJ Center Nguy·ªÖn Tr√£i</span>
                                </li>
                            </ul>
                            <div class="mt-4 pt-4 border-t border-stone-100">
                                <p class="text-sm font-bold text-stone-800">üëâ H√†nh ƒë·ªông:</p>
                                <p class="text-xs sm:text-sm text-stone-600">Ki·ªÉm tra ƒëi·ªán tho·∫°i tr·ª±c Fanpage/Google Maps ngay.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 3: Forecast & Strategy -->
                <section>
                    <div class="mb-4 sm:mb-6">
                        <h2 class="text-xl sm:text-2xl font-bold text-stone-800 mb-2">3. D·ª± B√°o Nhu C·∫ßu Qu√Ω 1/2026</h2>
                        <p class="text-sm sm:text-base text-stone-600 max-w-3xl">
                            Ph√¢n t√≠ch xu h∆∞·ªõng t√¨m ki·∫øm cho th·∫•y 3 ƒë·ª£t s√≥ng nhu c·∫ßu l·ªõn sau T·∫øt.
                        </p>
                    </div>

                    <div class="bg-white rounded-lg border border-stone-200 card-shadow overflow-hidden">
                        <!-- Custom Tabs (Scrollable on Mobile) -->
                        <div class="flex border-b border-stone-200 overflow-x-auto no-scrollbar">
                            <button onclick="switchTab('valentine')" id="tab-valentine" class="tab-btn-active px-4 sm:px-6 py-3 sm:py-4 text-sm font-medium focus:outline-none transition-colors whitespace-nowrap">
                                ‚ù§Ô∏è Valentine
                            </button>
                            <button onclick="switchTab('thantai')" id="tab-thantai" class="tab-btn-inactive px-4 sm:px-6 py-3 sm:py-4 text-sm font-medium focus:outline-none transition-colors whitespace-nowrap">
                                üí∞ Th·∫ßn T√†i
                            </button>
                            <button onclick="switchTab('women')" id="tab-women" class="tab-btn-inactive px-4 sm:px-6 py-3 sm:py-4 text-sm font-medium focus:outline-none transition-colors whitespace-nowrap">
                                üå∏ 8/3
                            </button>
                            <button onclick="switchTab('wedding')" id="tab-wedding" class="tab-btn-inactive px-4 sm:px-6 py-3 sm:py-4 text-sm font-medium focus:outline-none transition-colors whitespace-nowrap">
                                üíç M√πa C∆∞·ªõi
                            </button>
                        </div>

                        <div class="p-4 sm:p-6">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 items-center">
                                <!-- Left: Dynamic Content -->
                                <div id="tab-content">
                                    <!-- Injected by JS -->
                                </div>

                                <!-- Right: Trend Chart -->
                                <div>
                                    <h4 class="text-xs sm:text-sm font-bold text-stone-500 uppercase mb-4 text-center">D·ª± B√°o Xu H∆∞·ªõng T√¨m Ki·∫øm</h4>
                                    <div class="chart-container">
                                        <canvas id="trendChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 4: Action Checklist -->
                <section class="pb-8 sm:pb-12">
                    <h2 class="text-xl sm:text-2xl font-bold text-stone-800 mb-6">4. T√≥m L·∫°i: Vi·ªác C·∫ßn L√†m Ngay</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-stone-800 text-white p-6 rounded-lg shadow-lg flex flex-col items-center text-center">
                            <div class="w-12 h-12 bg-stone-700 rounded-full flex items-center justify-center text-2xl mb-4">üõ†Ô∏è</div>
                            <h3 class="text-lg sm:text-xl font-bold mb-2">S·ª≠a L·ªói K·∫øt N·ªëi</h3>
                            <p class="text-stone-300 text-sm">
                                C·ª≠a h√†ng Dƒ© An, Thu·∫≠n An ki·ªÉm tra Maps ngay. ƒê·ª´ng ƒë·ªÉ kh√°ch t√¨m ƒë·∫øn "nh√†" m√† kh√¥ng m·ªü c·ª≠a.
                            </p>
                        </div>
                        
                        <div class="bg-amber-600 text-white p-6 rounded-lg shadow-lg flex flex-col items-center text-center">
                            <div class="w-12 h-12 bg-amber-500 rounded-full flex items-center justify-center text-2xl mb-4">üì£</div>
                            <h3 class="text-lg sm:text-xl font-bold mb-2">M·ªü R·ªông V√πng Ph·ªß</h3>
                            <p class="text-amber-100 text-sm">
                                TƒÉng qu·∫£ng c√°o nh·∫π cho B√¨nh Ph∆∞·ªõc & V≈©ng T√†u. Ph·ªß s√≥ng th∆∞∆°ng hi·ªáu ƒë·∫øn nh·ªØng v√πng "tr·∫ßm".
                            </p>
                        </div>

                        <div class="bg-white border-2 border-stone-800 text-stone-800 p-6 rounded-lg shadow-lg flex flex-col items-center text-center">
                            <div class="w-12 h-12 bg-stone-100 rounded-full flex items-center justify-center text-2xl mb-4">üì¶</div>
                            <h3 class="text-lg sm:text-xl font-bold mb-2">Chu·∫©n B·ªã H√†ng</h3>
                            <p class="text-stone-600 text-sm">
                                Nh·∫≠p ƒë·ªß <strong>Nh·∫´n ƒë√¥i</strong> & <strong>V√†ng Th·∫ßn T√†i</strong>. ƒê√¢y l√† 2 m√≥n "hot" nh·∫•t qu√Ω n√†y.
                            </p>
                        </div>
                    </div>
                </section>
                
                <div class="h-12"></div> <!-- Spacer for footer -->
            </div>
        </main>

        <!-- VIEW 2: MAP DEEP DIVE (With Real Stores) -->
        <div id="view-map" class="absolute inset-0 flex flex-col md:flex-row hidden bg-white transition-opacity duration-300">
            <!-- Sidebar: Filter & List -->
            <div class="w-full md:w-80 lg:w-96 flex flex-col border-r border-stone-200 bg-white h-1/2 md:h-full z-20 shadow-lg md:shadow-none">
                <div class="p-4 border-b border-stone-200 bg-stone-50">
                    <h2 class="text-lg font-bold text-stone-800 mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-store text-amber-600"></i> Danh S√°ch C·ª≠a H√†ng
                    </h2>
                    <div class="space-y-2">
                        <select id="filter-province" onchange="filterStores()" class="w-full text-sm border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 p-2">
                            <option value="all">T·∫•t c·∫£ t·ªânh th√†nh</option>
                            <option value="B√¨nh D∆∞∆°ng">B√¨nh D∆∞∆°ng</option>
                            <option value="ƒê·ªìng Nai">ƒê·ªìng Nai</option>
                            <option value="B√† R·ªãa - V≈©ng T√†u">B√† R·ªãa - V≈©ng T√†u</option>
                            <option value="T√¢y Ninh">T√¢y Ninh</option>
                            <option value="B√¨nh Ph∆∞·ªõc">B√¨nh Ph∆∞·ªõc</option>
                        </select>
                        <select id="filter-status" onchange="filterStores()" class="w-full text-sm border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 p-2">
                            <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                            <option value="good">Ho·∫°t ƒë·ªông t·ªët</option>
                            <option value="warning">C·∫ßn x·ª≠ l√Ω (Zero Inbox)</option>
                        </select>
                    </div>
                </div>
                <div id="store-list" class="flex-grow overflow-y-auto custom-scrollbar p-2 space-y-2 bg-stone-50">
                    <!-- Store items will be injected here -->
                </div>
            </div>

            <!-- Map Container -->
            <div class="flex-grow h-1/2 md:h-full relative">
                <div id="map"></div>
                <!-- Legend -->
                <div class="absolute bottom-6 left-4 bg-white p-3 rounded shadow-lg z-[1000] text-xs border border-stone-200">
                    <div class="font-bold mb-2 text-stone-800">Ch√∫ th√≠ch</div>
                    <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 rounded-full bg-emerald-500"></span> Ho·∫°t ƒë·ªông t·ªët</div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-500"></span> C·∫ßn x·ª≠ l√Ω (Zero Inbox)</div>
                </div>
            </div>
        </div>

    </div>

    <!-- Floating Chatbot -->
    <div id="chatbot-container" class="fixed bottom-6 right-6 z-50 flex flex-col items-end">
        <div id="chatbot-window" class="bg-white rounded-2xl shadow-2xl border border-stone-200 w-[300px] sm:w-[350px] h-[450px] flex flex-col mb-4 hidden overflow-hidden">
            <div class="bg-amber-600 p-3 flex justify-between items-center text-white">
                <div class="flex items-center gap-2"><i class="fa-solid fa-robot"></i><span class="font-bold text-sm">Tr·ª£ l√Ω PNJ</span></div>
                <button onclick="toggleChat()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div id="chat-messages" class="flex-grow overflow-y-auto p-3 space-y-3 bg-stone-50 text-sm">
                <div class="flex justify-start"><div class="chat-bubble-ai p-2">Ch√†o b·∫°n! T√¥i c√≥ th·ªÉ gi√∫p g√¨ v·ªÅ b√°o c√°o v√† danh s√°ch c·ª≠a h√†ng?</div></div>
            </div>
            <div class="p-3 bg-white border-t border-stone-200 flex gap-2">
                <input type="text" id="chat-input" placeholder="H·ªèi..." class="flex-grow border rounded-full px-3 py-1 text-sm outline-none focus:border-amber-500" onkeypress="handleEnter(event)">
                <button onclick="sendMessage()" class="text-amber-600 hover:text-amber-700 transition-colors"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
        <button onclick="toggleChat()" class="bg-amber-600 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center hover:bg-amber-700 transition-transform hover:scale-105"><i class="fa-solid fa-comments text-xl"></i></button>
    </div>

    <script>
        // --- 0. SHARED API KEY ---
        const apiKey = ""; 

        // --- 1. VIEW SWITCHING LOGIC ---
        let mapInitialized = false;
        let currentMainView = 'report';

        function toggleMainView() {
            const btnIcon = document.getElementById('nav-toggle-icon');
            const btnText = document.getElementById('nav-toggle-text');
            const btnTextMobile = document.getElementById('nav-toggle-text-mobile');

            if (currentMainView === 'report') {
                // ƒêang ·ªü Report -> Chuy·ªÉn sang Map
                document.getElementById('view-report').classList.add('hidden');
                document.getElementById('view-map').classList.remove('hidden');
                
                btnIcon.className = 'fa-solid fa-chart-pie';
                btnText.innerText = 'Xem T·ªïng Quan';
                btnTextMobile.innerText = 'T·ªïng Quan';
                
                currentMainView = 'map';
                
                if (!mapInitialized) {
                    setTimeout(() => {
                        initMap();
                        mapInitialized = true;
                    }, 100);
                }
            } else {
                // ƒêang ·ªü Map -> Chuy·ªÉn sang Report
                document.getElementById('view-report').classList.remove('hidden');
                document.getElementById('view-map').classList.add('hidden');
                
                btnIcon.className = 'fa-solid fa-map-location-dot';
                btnText.innerText = 'Xem B·∫£n ƒê·ªì';
                btnTextMobile.innerText = 'B·∫£n ƒê·ªì';
                
                currentMainView = 'report';
            }
        }

        // --- 2. MAP & REAL STORE DATA ---
        
        // D·ªØ li·ªáu ngu·ªìn (Source Data) - M√¥ ph·ªèng c√°c tr∆∞·ªùng th√¥ng tin
        const rawStoreData = [
            // B√åNH D∆Ø∆†NG (20 C·ª≠a h√†ng)
            { id: 1, gmb: "PNJ Aeon Mall B√¨nh D∆∞∆°ng", fb: "PNJ Aeon Mall BD", address: "T·∫ßng Tr·ªát Aeon Mall, S·ªë 1 ƒê·∫°i L·ªô B√¨nh D∆∞∆°ng, Thu·∫≠n An", province: "B√¨nh D∆∞∆°ng", lat: 10.9351, lng: 106.7144, status: "good", rating: 4.8, inbox: 4315, directions: 2100 },
            { id: 2, gmb: "PNJ Center ƒê·∫°i L·ªô B√¨nh D∆∞∆°ng - TDM", fb: "", address: "359 ƒê·∫°i l·ªô B√¨nh D∆∞∆°ng, P. Ch√°nh Nghƒ©a, TP. Th·ªß D·∫ßu M·ªôt", province: "B√¨nh D∆∞∆°ng", lat: 10.9712, lng: 106.6745, status: "good", rating: 4.7, inbox: 894, directions: 560 },
            { id: 3, gmb: "PNJ H√πng V∆∞∆°ng - TDM", fb: "", address: "174 H√πng V∆∞∆°ng, P. Ph√∫ C∆∞·ªùng, TP. Th·ªß D·∫ßu M·ªôt", province: "B√¨nh D∆∞∆°ng", lat: 10.9823, lng: 106.6589, status: "good", rating: 4.6, inbox: 365, directions: 210 },
            { id: 4, gmb: "PNJ Yersin", fb: "", address: "66 Yersin, P. Hi·ªáp Th√†nh, TP. Th·ªß D·∫ßu M·ªôt", province: "B√¨nh D∆∞∆°ng", lat: 10.9789, lng: 106.6621, status: "good", rating: 4.5, inbox: 120, directions: 90 },
            { id: 5, gmb: "PNJ Lotte Mart B√¨nh D∆∞∆°ng", fb: "", address: "Khu ƒë√¥ th·ªã The Seasons, L√°i Thi√™u, Thu·∫≠n An", province: "B√¨nh D∆∞∆°ng", lat: 10.9087, lng: 106.7099, status: "good", rating: 4.7, inbox: 450, directions: 300 },
            { id: 6, gmb: "PNJ Vincom Dƒ© An", fb: "", address: "S·ªë 3 DT743, Khu ph·ªë Th·ªëng Nh·∫•t, Dƒ© An", province: "B√¨nh D∆∞∆°ng", lat: 10.9256, lng: 106.7589, status: "good", rating: 4.6, inbox: 380, directions: 250 },
            { id: 7, gmb: "", fb: "Fanpage PNJ Nguy·ªÖn Tr√£i - L√°i Thi√™u", address: "10 Nguy·ªÖn Tr√£i, L√°i Thi√™u, Thu·∫≠n An", province: "B√¨nh D∆∞∆°ng", lat: 10.9023, lng: 106.7012, status: "warning", rating: 4.1, inbox: 0, directions: 120 }, // Case: No GMB, use FB
            { id: 8, gmb: "PNJ Qu·ªëc L·ªô 1K - Dƒ© An", fb: "", address: "203 Qu·ªëc L·ªô 1K, P. Linh Xu√¢n, Dƒ© An", province: "B√¨nh D∆∞∆°ng", lat: 10.8999, lng: 106.7654, status: "warning", rating: 4.2, inbox: 0, directions: 310 }, // Zero Inbox
            { id: 9, gmb: "PNJ 22/12 - Thu·∫≠n An", fb: "", address: "ƒê∆∞·ªùng 22/12, Khu ph·ªë H√≤a L√¢n 2, Thu·∫≠n An", province: "B√¨nh D∆∞∆°ng", lat: 10.9456, lng: 106.7123, status: "warning", rating: 4.0, inbox: 0, directions: 150 }, // Zero Inbox
            { id: 10, gmb: "PNJ B·∫øn C√°t", fb: "", address: "QL13, M·ªπ Ph∆∞·ªõc, B·∫øn C√°t", province: "B√¨nh D∆∞∆°ng", lat: 11.1123, lng: 106.6012, status: "good", rating: 4.5, inbox: 210, directions: 110 },
            { id: 11, gmb: "PNJ T√¢n Uy√™n", fb: "", address: "ƒêT 746, Uy√™n H∆∞ng, T√¢n Uy√™n", province: "B√¨nh D∆∞∆°ng", lat: 11.0567, lng: 106.7890, status: "good", rating: 4.4, inbox: 180, directions: 95 },
            { id: 12, gmb: "PNJ Go! Dƒ© An", fb: "", address: "Trung t√¢m th∆∞∆°ng m·∫°i Go!, Dƒ© An", province: "B√¨nh D∆∞∆°ng", lat: 10.9123, lng: 106.7765, status: "good", rating: 4.6, inbox: 520, directions: 340 },
            { id: 13, gmb: "PNJ C√°ch M·∫°ng Th√°ng 8", fb: "", address: "555 CMT8, P. Ph√∫ C∆∞·ªùng, TP. Th·ªß D·∫ßu M·ªôt", province: "B√¨nh D∆∞∆°ng", lat: 10.9756, lng: 106.6678, status: "good", rating: 4.5, inbox: 230, directions: 140 },
            { id: 14, gmb: "PNJ Ph√∫ Ch√°nh", fb: "", address: "Hu·ª≥nh VƒÉn L≈©y, Ph√∫ Ch√°nh, T√¢n Uy√™n", province: "B√¨nh D∆∞∆°ng", lat: 11.0234, lng: 106.7345, status: "good", rating: 4.3, inbox: 90, directions: 50 },
            { id: 15, gmb: "PNJ M·ªπ Ph∆∞·ªõc 3", fb: "", address: "ƒê∆∞·ªùng NE8, KCN M·ªπ Ph∆∞·ªõc 3, B·∫øn C√°t", province: "B√¨nh D∆∞∆°ng", lat: 11.1256, lng: 106.6123, status: "good", rating: 4.4, inbox: 110, directions: 70 },
            { id: 16, gmb: "PNJ D·∫ßu Ti·∫øng", fb: "", address: "Th·ªã tr·∫•n D·∫ßu Ti·∫øng, Huy·ªán D·∫ßu Ti·∫øng", province: "B√¨nh D∆∞∆°ng", lat: 11.2789, lng: 106.3456, status: "good", rating: 4.5, inbox: 85, directions: 40 },
            { id: 17, gmb: "PNJ B√†u B√†ng", fb: "", address: "QL13, Th·ªã tr·∫•n Lai Uy√™n, B√†u B√†ng", province: "B√¨nh D∆∞∆°ng", lat: 11.2345, lng: 106.6345, status: "good", rating: 4.3, inbox: 95, directions: 45 },
            { id: 18, gmb: "PNJ Thu·∫≠n Giao", fb: "", address: "ƒê∆∞·ªùng Thu·∫≠n Giao 16, Thu·∫≠n An", province: "B√¨nh D∆∞∆°ng", lat: 10.9678, lng: 106.7234, status: "good", rating: 4.4, inbox: 140, directions: 80 },
            { id: 19, gmb: "PNJ An Ph√∫", fb: "", address: "V√≤ng xoay An Ph√∫, Thu·∫≠n An", province: "B√¨nh D∆∞∆°ng", lat: 10.9345, lng: 106.7456, status: "good", rating: 4.5, inbox: 200, directions: 120 },
            { id: 20, gmb: "PNJ B√¨nh Chu·∫©n", fb: "", address: "Ng√£ t∆∞ B√¨nh Chu·∫©n, Thu·∫≠n An", province: "B√¨nh D∆∞∆°ng", lat: 10.9890, lng: 106.7567, status: "good", rating: 4.3, inbox: 130, directions: 75 },

            // ƒê·ªíNG NAI (15 C·ª≠a h√†ng)
            { id: 21, gmb: "PNJ Vincom Bi√™n H√≤a", fb: "", address: "1096 Ph·∫°m VƒÉn Thu·∫≠n, P. T√¢n Mai, Bi√™n H√≤a", province: "ƒê·ªìng Nai", lat: 10.9578, lng: 106.8456, status: "good", rating: 4.8, inbox: 650, directions: 410 },
            { id: 22, gmb: "PNJ ƒê·ªìng Kh·ªüi", fb: "", address: "235 ƒê·ªìng Kh·ªüi, P. Tam Hi·ªáp, Bi√™n H√≤a", province: "ƒê·ªìng Nai", lat: 10.9612, lng: 106.8567, status: "good", rating: 4.7, inbox: 510, directions: 320 },
            { id: 23, gmb: "PNJ H√πng V∆∞∆°ng - Long Kh√°nh", fb: "", address: "123 H√πng V∆∞∆°ng, TP. Long Kh√°nh", province: "ƒê·ªìng Nai", lat: 10.9345, lng: 107.2345, status: "good", rating: 4.9, inbox: 970, directions: 550 },
            { id: 24, gmb: "PNJ BigC ƒê·ªìng Nai", fb: "", address: "Ng√£ 3 V≈©ng T√†u, P. Long B√¨nh T√¢n, Bi√™n H√≤a", province: "ƒê·ªìng Nai", lat: 10.9123, lng: 106.8678, status: "good", rating: 4.6, inbox: 420, directions: 280 },
            { id: 25, gmb: "PNJ V√µ Th·ªã S√°u", fb: "", address: "ƒê∆∞·ªùng V√µ Th·ªã S√°u, P. Th·ªëng Nh·∫•t, Bi√™n H√≤a", province: "ƒê·ªìng Nai", lat: 10.9456, lng: 106.8345, status: "good", rating: 4.6, inbox: 353, directions: 190 },
            { id: 26, gmb: "PNJ 30/4", fb: "", address: "ƒê∆∞·ªùng 30/4, P. Trung D≈©ng, Bi√™n H√≤a", province: "ƒê·ªìng Nai", lat: 10.9512, lng: 106.8234, status: "good", rating: 4.5, inbox: 290, directions: 150 },
            { id: 27, gmb: "PNJ Long Th√†nh", fb: "", address: "L√™ Du·∫©n, Th·ªã tr·∫•n Long Th√†nh", province: "ƒê·ªìng Nai", lat: 10.7890, lng: 106.9456, status: "good", rating: 4.5, inbox: 310, directions: 180 },
            { id: 28, gmb: "PNJ Nh∆°n Tr·∫°ch", fb: "", address: "ƒê∆∞·ªùng T√¥n ƒê·ª©c Th·∫Øng, Hi·ªáp Ph∆∞·ªõc, Nh∆°n Tr·∫°ch", province: "ƒê·ªìng Nai", lat: 10.7345, lng: 106.9876, status: "good", rating: 4.4, inbox: 180, directions: 100 },
            { id: 29, gmb: "PNJ Tr·∫£ng Bom", fb: "", address: "QL1A, Th·ªã tr·∫•n Tr·∫£ng Bom", province: "ƒê·ªìng Nai", lat: 10.9567, lng: 107.0123, status: "good", rating: 4.5, inbox: 220, directions: 130 },
            { id: 30, gmb: "PNJ Gia Ki·ªám", fb: "", address: "QL20, Gia Ki·ªám, Th·ªëng Nh·∫•t", province: "ƒê·ªìng Nai", lat: 11.0234, lng: 107.1234, status: "good", rating: 4.3, inbox: 90, directions: 40 },
            { id: 31, gmb: "PNJ ƒê·ªãnh Qu√°n", fb: "", address: "QL20, Th·ªã tr·∫•n ƒê·ªãnh Qu√°n", province: "ƒê·ªìng Nai", lat: 11.2123, lng: 107.2890, status: "good", rating: 4.4, inbox: 110, directions: 60 },
            { id: 32, gmb: "PNJ T√¢n Ph√∫", fb: "", address: "Th·ªã tr·∫•n T√¢n Ph√∫, ƒê·ªìng Nai", province: "ƒê·ªìng Nai", lat: 11.3456, lng: 107.3567, status: "good", rating: 4.3, inbox: 80, directions: 30 },
            { id: 33, gmb: "PNJ Lotte Mart Bi√™n H√≤a", fb: "", address: "KCN Amata, P. Long B√¨nh, Bi√™n H√≤a", province: "ƒê·ªìng Nai", lat: 10.9345, lng: 106.8789, status: "good", rating: 4.6, inbox: 340, directions: 210 },
            { id: 34, gmb: "PNJ Tam Hi·ªáp", fb: "", address: "Ph·∫°m VƒÉn Thu·∫≠n, P. Tam Hi·ªáp, Bi√™n H√≤a", province: "ƒê·ªìng Nai", lat: 10.9489, lng: 106.8512, status: "good", rating: 4.5, inbox: 160, directions: 90 },
            { id: 35, gmb: "PNJ H·ªë Nai", fb: "", address: "Nguy·ªÖn √Åi Qu·ªëc, P. H·ªë Nai, Bi√™n H√≤a", province: "ƒê·ªìng Nai", lat: 10.9678, lng: 106.8890, status: "good", rating: 4.4, inbox: 140, directions: 80 },

            // B√Ä R·ªäA - V≈®NG T√ÄU (10 C·ª≠a h√†ng)
            { id: 36, gmb: "PNJ L√™ H·ªìng Phong", fb: "", address: "380 L√™ H·ªìng Phong, P. Th·∫Øng Tam, TP. V≈©ng T√†u", province: "B√† R·ªãa - V≈©ng T√†u", lat: 10.3567, lng: 107.0890, status: "good", rating: 4.7, inbox: 450, directions: 300 },
            { id: 37, gmb: "PNJ Ba Cu", fb: "", address: "89 Ba Cu, P. 4, TP. V≈©ng T√†u", province: "B√† R·ªãa - V≈©ng T√†u", lat: 10.3456, lng: 107.0789, status: "good", rating: 4.8, inbox: 520, directions: 350 },
            { id: 38, gmb: "PNJ Lotte Mart V≈©ng T√†u", fb: "", address: "ƒê∆∞·ªùng 3/2, P. 8, TP. V≈©ng T√†u", province: "B√† R·ªãa - V≈©ng T√†u", lat: 10.3345, lng: 107.0912, status: "good", rating: 4.6, inbox: 380, directions: 240 },
            { id: 39, gmb: "PNJ B√† R·ªãa", fb: "", address: "ƒê∆∞·ªùng C√°ch M·∫°ng Th√°ng 8, P. Ph∆∞·ªõc Hi·ªáp, TP. B√† R·ªãa", province: "B√† R·ªãa - V≈©ng T√†u", lat: 10.4987, lng: 107.1678, status: "good", rating: 4.6, inbox: 290, directions: 180 },
            { id: 40, gmb: "PNJ Ph√∫ M·ªπ", fb: "", address: "QL51, Th·ªã x√£ Ph√∫ M·ªπ", province: "B√† R·ªãa - V≈©ng T√†u", lat: 10.5890, lng: 107.0567, status: "good", rating: 4.5, inbox: 210, directions: 130 },
            { id: 41, gmb: "PNJ Lapen Center", fb: "", address: "33A ƒê∆∞·ªùng 30/4, P. 9, TP. V≈©ng T√†u", province: "B√† R·ªãa - V≈©ng T√†u", lat: 10.3512, lng: 107.0845, status: "good", rating: 4.5, inbox: 180, directions: 110 },
            { id: 42, gmb: "PNJ Xuy√™n M·ªôc", fb: "", address: "Th·ªã tr·∫•n Ph∆∞·ªõc B·ª≠u, Xuy√™n M·ªôc", province: "B√† R·ªãa - V≈©ng T√†u", lat: 10.6345, lng: 107.3456, status: "good", rating: 4.4, inbox: 90, directions: 50 },
            { id: 43, gmb: "PNJ Ng√£i Giao", fb: "", address: "Th·ªã tr·∫•n Ng√£i Giao, Ch√¢u ƒê·ª©c", province: "B√† R·ªãa - V≈©ng T√†u", lat: 10.6123, lng: 107.1890, status: "good", rating: 4.3, inbox: 70, directions: 30 },
            { id: 44, gmb: "PNJ Long ƒêi·ªÅn", fb: "", address: "Th·ªã tr·∫•n Long ƒêi·ªÅn, Long ƒêi·ªÅn", province: "B√† R·ªãa - V≈©ng T√†u", lat: 10.4789, lng: 107.2123, status: "good", rating: 4.2, inbox: 60, directions: 25 },
            { id: 45, gmb: "PNJ ƒê·∫•t ƒê·ªè", fb: "", address: "Th·ªã tr·∫•n ƒê·∫•t ƒê·ªè, ƒê·∫•t ƒê·ªè", province: "B√† R·ªãa - V≈©ng T√†u", lat: 10.4890, lng: 107.2678, status: "good", rating: 4.3, inbox: 50, directions: 20 },

            // T√ÇY NINH (7 C·ª≠a h√†ng)
            { id: 46, gmb: "PNJ CMT8 T√¢y Ninh", fb: "", address: "915 CMT8, P. Hi·ªáp Ninh, TP. T√¢y Ninh", province: "T√¢y Ninh", lat: 11.3123, lng: 106.1012, status: "good", rating: 4.7, inbox: 340, directions: 200 },
            { id: 47, gmb: "PNJ Vincom T√¢y Ninh", fb: "", address: "444 ƒê∆∞·ªùng 30/4, TP. T√¢y Ninh", province: "T√¢y Ninh", lat: 11.3056, lng: 106.1123, status: "good", rating: 4.8, inbox: 410, directions: 260 },
            { id: 48, gmb: "PNJ H√≤a Th√†nh", fb: "", address: "H√πng V∆∞∆°ng, Th·ªã x√£ H√≤a Th√†nh", province: "T√¢y Ninh", lat: 11.2789, lng: 106.1234, status: "good", rating: 4.5, inbox: 190, directions: 110 },
            { id: 49, gmb: "PNJ G√≤ D·∫ßu", fb: "", address: "QL22B, Th·ªã tr·∫•n G√≤ D·∫ßu", province: "T√¢y Ninh", lat: 11.0890, lng: 106.2456, status: "good", rating: 4.4, inbox: 130, directions: 70 },
            { id: 50, gmb: "PNJ Tr·∫£ng B√†ng", fb: "", address: "QL22, Th·ªã x√£ Tr·∫£ng B√†ng", province: "T√¢y Ninh", lat: 11.0345, lng: 106.3567, status: "good", rating: 4.5, inbox: 150, directions: 90 },
            { id: 51, gmb: "PNJ Ch√¢u Th√†nh", fb: "", address: "Th·ªã tr·∫•n Ch√¢u Th√†nh, T√¢y Ninh", province: "T√¢y Ninh", lat: 11.2890, lng: 106.0123, status: "good", rating: 4.2, inbox: 60, directions: 30 },
            { id: 52, gmb: "PNJ T√¢n Bi√™n", fb: "", address: "Th·ªã tr·∫•n T√¢n Bi√™n, T√¢y Ninh", province: "T√¢y Ninh", lat: 11.5678, lng: 105.9345, status: "good", rating: 4.3, inbox: 50, directions: 20 },

            // B√åNH PH∆Ø·ªöC (5 C·ª≠a h√†ng)
            { id: 53, gmb: "PNJ ƒê·ªìng Xo√†i", fb: "", address: "ƒê∆∞·ªùng Ph√∫ Ri·ªÅng ƒê·ªè, TP. ƒê·ªìng Xo√†i", province: "B√¨nh Ph∆∞·ªõc", lat: 11.5345, lng: 106.9123, status: "good", rating: 4.6, inbox: 280, directions: 160 },
            { id: 54, gmb: "PNJ Ph∆∞·ªõc Long", fb: "", address: "ƒê∆∞·ªùng ƒêT 741, Th·ªã x√£ Ph∆∞·ªõc Long", province: "B√¨nh Ph∆∞·ªõc", lat: 11.8234, lng: 106.9890, status: "good", rating: 4.4, inbox: 120, directions: 60 },
            { id: 55, gmb: "PNJ B√¨nh Long", fb: "", address: "Phan B·ªôi Ch√¢u, Th·ªã x√£ B√¨nh Long", province: "B√¨nh Ph∆∞·ªõc", lat: 11.6567, lng: 106.6012, status: "good", rating: 4.3, inbox: 100, directions: 50 },
            { id: 56, gmb: "PNJ Ch∆°n Th√†nh", fb: "", address: "QL13, Th·ªã tr·∫•n Ch∆°n Th√†nh", province: "B√¨nh Ph∆∞·ªõc", lat: 11.4567, lng: 106.6678, status: "good", rating: 4.4, inbox: 140, directions: 80 },
            { id: 57, gmb: "", fb: "", address: "QL13, Th·ªã tr·∫•n L·ªôc Ninh", province: "B√¨nh Ph∆∞·ªõc", lat: 11.8456, lng: 106.5890, status: "good", rating: 4.2, inbox: 40, directions: 20 } // Case: No GMB, No FB
        ];

        // X·ª≠ l√Ω logic t√™n hi·ªÉn th·ªã: GMB > FB > ID
        const realStores = rawStoreData.map(store => {
            let displayName = store.id.toString(); // Default to ID
            if (store.gmb && store.gmb.trim() !== "") {
                displayName = store.gmb;
            } else if (store.fb && store.fb.trim() !== "") {
                displayName = store.fb;
            } else {
                displayName = "C·ª≠a h√†ng #" + store.id;
            }
            
            return {
                ...store,
                name: displayName
            };
        });

        let map, markers = [];

        function initMap() {
            map = L.map('map').setView([11.1, 106.8], 9); // Zoomed out slightly to fit all

            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap &copy; CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);

            renderStoreList(realStores);
            renderMarkers(realStores);
        }

        function renderMarkers(stores) {
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            stores.forEach(store => {
                const color = store.status === 'good' ? '#10b981' : '#ef4444';
                const circleMarker = L.circleMarker([store.lat, store.lng], {
                    color: '#fff',
                    weight: 1,
                    fillColor: color,
                    fillOpacity: 0.9,
                    radius: 8
                }).addTo(map);

                // Detailed Popup with Metrics
                const popupContent = `
                    <div class="text-sm font-sans min-w-[200px]">
                        <strong class="text-amber-700 block mb-1 text-base border-b pb-1">${store.name}</strong>
                        <div class="text-gray-600 mb-2 text-xs italic">${store.address}</div>
                        
                        <div class="grid grid-cols-2 gap-2 text-xs mt-2">
                            <div class="bg-stone-50 p-1 rounded border text-center">
                                <div class="text-stone-400">Review</div>
                                <div class="font-bold text-amber-500">‚≠ê ${store.rating}</div>
                            </div>
                            <div class="bg-stone-50 p-1 rounded border text-center">
                                <div class="text-stone-400">Inbox</div>
                                <div class="font-bold ${store.status === 'good' ? 'text-blue-600' : 'text-red-600'}">${store.inbox}</div>
                            </div>
                            <div class="bg-stone-50 p-1 rounded border text-center col-span-2">
                                <span class="text-stone-400 mr-1">Ch·ªâ ƒë∆∞·ªùng:</span>
                                <span class="font-bold text-emerald-600">${store.directions} l∆∞·ª£t</span>
                            </div>
                        </div>
                    </div>
                `;
                
                circleMarker.bindPopup(popupContent);
                circleMarker.on('click', () => highlightStoreInList(store.id));
                markers.push(circleMarker);
            });
        }

        function renderStoreList(stores) {
            const container = document.getElementById('store-list');
            container.innerHTML = '';

            if (stores.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-4 text-sm">Kh√¥ng t√¨m th·∫•y c·ª≠a h√†ng</div>';
                return;
            }

            stores.forEach(store => {
                const div = document.createElement('div');
                div.className = `store-item p-3 bg-white rounded border border-stone-200 hover:shadow-md cursor-pointer transition-all flex flex-col gap-1`;
                div.id = `store-${store.id}`;
                
                // Detailed List Item
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="font-bold text-stone-800 text-sm w-3/4">${store.name}</div>
                        ${store.status === 'warning' 
                            ? '<span class="text-red-500 text-[10px] font-bold bg-red-50 px-1.5 py-0.5 rounded border border-red-100 whitespace-nowrap"><i class="fa-solid fa-triangle-exclamation"></i> Alert</span>' 
                            : `<span class="text-emerald-600 text-[10px] font-bold bg-emerald-50 px-1.5 py-0.5 rounded border border-emerald-100 whitespace-nowrap">${store.rating} ‚≠ê</span>`
                        }
                    </div>
                    <div class="text-[11px] text-stone-500 truncate"><i class="fa-solid fa-location-dot text-amber-500 mr-1"></i>${store.address}</div>
                    
                    <div class="flex gap-3 mt-1 pt-1 border-t border-stone-100 text-[11px] text-stone-600">
                        <span title="Tin nh·∫Øn"><i class="fa-regular fa-comment-dots"></i> ${store.inbox}</span>
                        <span title="Ch·ªâ ƒë∆∞·ªùng"><i class="fa-solid fa-diamond-turn-right"></i> ${store.directions}</span>
                    </div>
                `;
                div.onclick = () => {
                    map.setView([store.lat, store.lng], 15);
                    highlightStoreInList(store.id);
                    // Open popup for the corresponding marker
                    const markerIndex = realStores.findIndex(s => s.id === store.id); // Simple mapping since data is static
                    // In a real filtered scenario, we'd need a map of ID -> Marker Layer
                };
                container.appendChild(div);
            });
        }

        function filterStores() {
            const prov = document.getElementById('filter-province').value;
            const status = document.getElementById('filter-status').value;

            const filtered = realStores.filter(s => {
                const matchProv = prov === 'all' || s.province === prov;
                const matchStatus = status === 'all' || s.status === status;
                return matchProv && matchStatus;
            });

            renderStoreList(filtered);
            renderMarkers(filtered);
            
            if (filtered.length > 0 && map) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        function highlightStoreInList(id) {
            document.querySelectorAll('.store-item').forEach(el => el.classList.remove('active'));
            const item = document.getElementById(`store-${id}`);
            if (item) {
                item.classList.add('active');
                item.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // --- 3. REPORT CHART LOGIC (Full Version Restored) ---
        
        // Regional Chart
        const ctxRegion = document.getElementById('regionalChart').getContext('2d');
        new Chart(ctxRegion, {
            type: 'bar',
            data: {
                labels: ['ƒê·ªìng Nai', 'B√¨nh D∆∞∆°ng', 'T√¢y Ninh', 'BR - VT', 'B√¨nh Ph∆∞·ªõc'],
                datasets: [{
                    label: 'M·ª©c ƒë·ªô hi·ªáu qu·∫£ (Thang ƒëi·ªÉm 10)',
                    data: [9.5, 8.0, 6.0, 4.0, 2.5],
                    backgroundColor: ['#10b981', '#34d399', '#facc15', '#f87171', '#ef4444'],
                    borderColor: ['#10b981', '#34d399', '#facc15', '#f87171', '#ef4444'],
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) { return context.raw + '/10 ƒëi·ªÉm'; }
                        }
                    }
                },
                scales: {
                    x: { beginAtZero: true, max: 10, title: { display: true, text: 'Hi·ªáu Su·∫•t' } }
                }
            }
        });

        // Detailed Forecast Data
        const forecastData = {
            valentine: {
                title: "Qu√† Valentine (14/2)",
                keywords: '"Qu√† Valentine", "Nh·∫´n ƒë√¥i", "T·∫∑ng b·∫°n g√°i"',
                growth: "+200%",
                products: ["B·∫°c", "Nh·∫´n ƒë√¥i", "Disney", "Style"],
                action: "Tr∆∞ng b√†y set qu√† gi√° m·ªÅm, d·ªÖ g√≥i, d·ªÖ t·∫∑ng ngay c·ª≠a ra v√†o.",
                chartData: [20, 40, 95, 80, 40, 20, 15]
            },
            thantai: {
                title: "V√≠a Th·∫ßn T√†i (10/1 √ÇL)",
                keywords: '"V√†ng th·∫ßn t√†i", "Nh·∫´n kim ti·ªÅn", "Gi√° v√†ng"',
                growth: "+500%",
                products: ["V√†ng 99.99", "V√†ng Mini", "V√†ng mi·∫øng"],
                action: "Chu·∫©n b·ªã b·∫£ng gi√° to, r√µ. Nh√¢n vi√™n tr·ª±c tin nh·∫Øn tr·∫£ l·ªùi nhanh v·ªÅ gi√°.",
                chartData: [20, 25, 30, 40, 100, 40, 20]
            },
            women: {
                title: "Qu·ªëc T·∫ø Ph·ª• N·ªØ (8/3)",
                keywords: '"Qu√† 8/3", "T·∫∑ng m·∫π", "B√¥ng tai"',
                growth: "TƒÉng ·ªïn ƒë·ªãnh",
                products: ["ƒê√° qu√Ω", "Kim c∆∞∆°ng", "Nh·∫´n n·ªØ"],
                action: "Chu·∫©n b·ªã m·∫´u sang tr·ªçng, th√¥ng ƒëi·ªáp v·ªÅ s·ª± tr√¢n tr·ªçng.",
                chartData: [15, 20, 25, 30, 60, 100, 60]
            },
            wedding: {
                title: "M√πa C∆∞·ªõi (Sau T·∫øt)",
                keywords: '"Nh·∫´n c∆∞·ªõi ƒë·∫πp", "B·ªô v√†ng 24K"',
                growth: "+30-40%",
                products: ["Nh·∫´n c∆∞·ªõi", "Ki·ªÅng c∆∞·ªõi", "V√†ng 24K"],
                action: "M·ªùi kh√°ch ra c·ª≠a h√†ng 'th·ª≠ ni tay'. ·∫¢nh Google Maps ph·∫£i ƒë·∫πp.",
                chartData: [30, 35, 40, 45, 50, 60, 65]
            }
        };

        let trendChart;
        function updateTrendChart(key) {
            const data = forecastData[key];
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            // Labels timeline
            const labels = [
                ['15/01', ''],
                ['01/02', ''],
                ['14/02', 'Valentine'],
                ['17/02', 'T·∫øt AL'],
                ['26/02', 'Th·∫ßn T√†i'],
                ['08/03', 'Q.T.P.N'],
                ['15/03', '']
            ];

            if (trendChart) {
                trendChart.data.datasets[0].data = data.chartData;
                trendChart.update();
            } else {
                trendChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'L∆∞·ª£ng T√¨m Ki·∫øm',
                            data: data.chartData,
                            borderColor: '#d97706',
                            backgroundColor: 'rgba(217, 119, 6, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#d97706',
                            pointRadius: 4,
                            pointHitRadius: 15
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { 
                                intersect: false, 
                                mode: 'index',
                                bodyFont: { size: 12 },
                                titleFont: { size: 13 },
                                padding: 10,
                                callbacks: {
                                    title: function(context) {
                                        const label = context[0].label;
                                        if (Array.isArray(label)) return label.join(' - ').replace(' - ', ' ').trim();
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { beginAtZero: true, display: false },
                            x: { 
                                grid: { display: false },
                                ticks: { font: {size: 11, lineHeight: 1.2}, autoSkip: false }
                            }
                        }
                    }
                });
            }
        }

        function switchTab(key) {
            ['valentine', 'thantai', 'women', 'wedding'].forEach(k => {
                const btn = document.getElementById(`tab-${k}`);
                if (k === key) {
                    btn.classList.remove('tab-btn-inactive');
                    btn.classList.add('tab-btn-active');
                } else {
                    btn.classList.remove('tab-btn-active');
                    btn.classList.add('tab-btn-inactive');
                }
            });

            const data = forecastData[key];
            const contentHtml = `
                <div class="animate-fade-in">
                    <h3 class="text-xl sm:text-2xl font-bold text-amber-600 mb-2">${data.title}</h3>
                    <div class="mb-4">
                        <span class="bg-stone-100 text-stone-600 text-xs font-bold px-2 py-1 rounded">D·ª± b√°o: ${data.growth}</span>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-3 rounded border border-blue-100">
                            <p class="text-xs text-blue-500 font-bold uppercase mb-1">üîç T·ª´ kh√≥a Hot</p>
                            <p class="text-stone-800 font-medium text-sm">${data.keywords}</p>
                        </div>
                        <div class="bg-amber-50 p-3 rounded border border-amber-100">
                            <p class="text-xs text-amber-600 font-bold uppercase mb-1">üíç D√≤ng h√†ng ch·ªß l·ª±c</p>
                            <div class="flex flex-wrap gap-2">
                                ${data.products.map(p => `<span class="bg-white text-stone-700 text-xs px-2 py-1 rounded border border-amber-200 shadow-sm">${p}</span>`).join('')}
                            </div>
                        </div>
                        <div class="bg-stone-50 p-3 rounded border border-stone-200">
                            <p class="text-xs text-stone-500 font-bold uppercase mb-1">‚ö° Vi·ªác c·∫ßn l√†m</p>
                            <p class="text-stone-700 italic text-sm">"${data.action}"</p>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('tab-content').innerHTML = contentHtml;
            updateTrendChart(key);
        }

        // --- 4. CHATBOT LOGIC (Existing) ---
        function getReportContext() {
            const mainContent = document.querySelector('main').innerText;
            return mainContent.replace(/\s+/g, ' ').trim().substring(0, 10000);
        }
        function toggleChat() {
            const win = document.getElementById('chatbot-window');
            if (win.classList.contains('hidden')) {
                win.classList.remove('hidden');
                setTimeout(() => document.getElementById('chat-input').focus(), 100);
            } else {
                win.classList.add('hidden');
            }
        }
        function handleEnter(e) { if(e.key==='Enter') sendMessage(); }
        async function sendMessage() {
            const inputEl = document.getElementById('chat-input');
            const msgContainer = document.getElementById('chat-messages');
            const userText = inputEl.value.trim();
            if (!userText) return;

            msgContainer.innerHTML += `<div class="flex justify-end"><div class="chat-bubble-user p-2 max-w-[85%]">${userText}</div></div>`;
            inputEl.value = '';
            
            const loadingId = 'loading-' + Date.now();
            msgContainer.innerHTML += `<div id="${loadingId}" class="flex justify-start"><div class="chat-bubble-ai p-2"><div class="typing-indicator"><span></span><span></span><span></span></div></div></div>`;
            msgContainer.scrollTop = msgContainer.scrollHeight;

            try {
                const context = getReportContext();
                const systemPrompt = `B·∫°n l√† tr·ª£ l√Ω AI PNJ. Tr·∫£ l·ªùi d·ª±a tr√™n b√°o c√°o n√†y: """${context}""". Tr·∫£ l·ªùi ng·∫Øn g·ªçn.`;
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: systemPrompt + "\nC√¢u h·ªèi: " + userText }] }] })
                });
                const data = await response.json();
                const aiRes = data.candidates[0].content.parts[0].text;
                document.getElementById(loadingId).remove();
                msgContainer.innerHTML += `<div class="flex justify-start"><div class="chat-bubble-ai p-2 max-w-[85%]">${aiRes}</div></div>`;
            } catch (e) {
                document.getElementById(loadingId).remove();
                msgContainer.innerHTML += `<div class="flex justify-start"><div class="chat-bubble-ai p-2 text-red-500">L·ªói k·∫øt n·ªëi AI.</div></div>`;
            }
            msgContainer.scrollTop = msgContainer.scrollHeight;
        }

        // Initialize
        switchTab('valentine');
    </script>
</body>
</html>
